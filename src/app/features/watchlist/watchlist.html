<section aria-label="Wishlist Section" class="mt-3">
  <!--============== TITLE ==============-->
  <h3 class="font-primary text-2xl md:text-3xl lg:text-4xl text-dark-10">
    Your Watchlist
  </h3>

  <!--============== EMPTY STATE ==============-->
  @if (watchListProducts$().length === 0) {
  <div class="flex flex-col gap-5 mt-3 py-10 items-center">
    <img src="not-found.svg" alt="Not Found SVG" />
    <h3 class="font-primary text-center text-dark-10 font-medium text-xl">
      Your Wishlist is empty
    </h3>
  </div>
  }

  <!--============== WATCHLIST ITEMS ==============-->
  @if (watchListProducts$().length > 0) {
  <ul
    class="grid place-items-center grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-5 mt-5"
  >
    @for (watchItem of watchListProducts$(); track watchItem.id) {
    <li
      class="relative rounded-lg p-2 bg-neutral-700 aspect-[2/3] w-[140px] lg:w-[180px] max-w-[180px] group shrink-0 overflow-hidden"
    >
      <!--============== POSTER ==============-->
      <figure class="rounded-lg overflow-hidden">
        <img
          [src]="watchItem.poster_path ? posterPath + watchItem.poster_path : 'no-poster-available.jpg'"
          [alt]="watchItem.title || 'Unknown poster'"
          [routerLink]="watchItem.media_type === 'movie' ? ['/movie', watchItem.id] : ['/series', watchItem.id]"
          width="500"
          height="500"
          loading="lazy"
          class="object-cover cursor-pointer rounded-lg transition-all duration-300 ease-in-out group-hover:brightness-110 group-hover:scale-105 group-hover:rotate-3"
        />

        <!--============== RATING ==============-->
        <span
          class="absolute top-3 left-3 flex items-center gap-1.5 bg-neutral-800 rounded-lg px-1.5 py-0.5 text-lg"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="#e7bc0f"
            stroke="#e7bc0f"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-star-icon lucide-star"
          >
            <path
              d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"
            />
          </svg>
          <small class="flex items-center gap-0.5">
            {{ watchItem.vote_average | number:'1.1-1' }}
            <span class="text-neutral-400 font-medium">/10</span>
          </small>
        </span>

        <!--============== TOGGLE WATCHLIST ==============-->
        <button
          class="absolute top-1 right-0.5 grid place-items-center bg-neutral-700 p-1.5 rounded-bl-lg rounded-br-lg z-30"
          aria-label="Toggle Wishlist"
          (click)="toggleWatchlist(watchItem)"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="30"
            height="30"
            viewBox="0 0 24 24"
            fill="white"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-heart-icon lucide-heart bg-neutral-500 p-1.5 rounded-lg hover:fill-red-600 hover:stroke-red-600 transition-colors duration-200 ease-in-out"
            [ngClass]="{ 'fill-red-600 stroke-red-600': isAlreadyInWatchlist(watchItem) }"
          >
            <path
              d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5"
            />
          </svg>
        </button>
      </figure>

      <!--============== TITLE & GENRES ==============-->
      <div
        class="absolute flex flex-col items-center justify-center backdrop-blur-lg left-2 right-2 bottom-2 overflow-hidden py-1.5 rounded-b-lg"
      >
        <!-- Title -->
        <h3
          class="font-medium xl:text-lg font-primary! line-clamp-1 text-center"
        >
          {{ watchItem.title || "Unknown" }}
        </h3>

        <!-- Genres -->
        <ul class="flex items-center gap-1">
          @for (genre of watchItem.genre_ids.slice(0,1); track genre) {
          <li class="text-neutral-300 line-clamp-1">
            {{ moviesGenres[genre] || seriesGenres[genre] || "Unknown" }}
          </li>
          }
        </ul>
      </div>
    </li>
    }
  </ul>
  }
</section>
